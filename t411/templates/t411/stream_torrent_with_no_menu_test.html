
{% load static %}
{% load bootstrap3 %}
{% load t411_extras %}
{# Load CSS and JavaScript #}
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <title> {% block title %}RuFy{% endblock %}</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="{% static "js/search.js" %}"></script>
  <script src="{% static 'django_js_reverse/js/reverse.js' %}"></script>
      <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
      <link rel="stylesheet" href="https://cdn.plyr.io/1.8.12/plyr.css">
  <!-- If you'd like to support IE8 -->
  <script src="http://vjs.zencdn.net/ie8/1.1.2/videojs-ie8.min.js"></script>
  <link href="{% static "css/rufy.css" %}" rel="stylesheet">
  {% bootstrap_css %}
  {% bootstrap_javascript %}
  {% block head %}
  {% endblock %}
  </head>
  <body>
{% block content %}

<center>
    <script>
        $(window).load(function () {




            var ip = '{{ ip_address }}';
            var api = 'http://' + ip + ':3000/';
            var socket = io.connect(api);
            socket.emit('getMeta', {filename : '{{nomFichier}}', id_torrent : '{{id_torrent}}'});
            var player = document.querySelector('#player');
            plyr.setup(player);
            $('.video').show();

            socket.on('background-player', function(msg){
                console.log('receiving metadata from tmdb : '+msg);
               document.getElementsByTagName("video")[0].setAttribute("poster", 'http://image.tmdb.org/t/p/w500' + msg);
            });
            $.post(api + 'streamtorrent/add', { torrent : "{{ chemin }}", id : {{ id_torrent }} }).done( function( data ){
                    setTimeout(function(){
                        var videomp4 = api + 'streamtorrent/' + '{{id_torrent}}' + '.mp4';
                        var videowebm = api + 'streamtorrent/' + '{{id_torrent}}' + '.webm';
                        $('.player').append('<source src=' + videomp4 + ' type="video/mp4">')
                        $('.player').append('<source src=' + videowebm + ' type="video/webm">');
                        //$('video').attr('src' video2);
                        $('.input').hide();
                        $('.video').show();
                    }, 2000);
            });
        });
        $(window).unload(function() {
            var id = {{ id_torrent }};
            var ip = '{{ ip_address }}';
            var api = 'http://' + ip + ':3000/';
            $.get(api + 'delete/' + id).done(function(data){
                console.log("removed torrent");
            });
        });
        $('.video').play();


    </script>



            <video class="player" autoplay preload="none" controls crossorigin id="player"   style="position: fixed; right: 0; bottom: 0; min-width: 100%; min-height: 100%; width: auto; height: auto; z-index: -100; background: url(polina.jpg) no-repeat; background-size: cover;background-color:black; "

            </video>
</center>
<script src="https://cdn.plyr.io/1.8.12/plyr.js"></script>

{% endblock %}
